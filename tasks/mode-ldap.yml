---
- name: Assert required LDAP variables
  assert:
    that:
      - dhcpd__ldap_server is defined
      - dhcpd__ldap_basedn is defined
      - dhcpd__ldap_method in ['static', 'dynamic']
      - dhcpd__ldap_ssl is not defined or dhcpd__ldap_ssl in ['start_tls', 'ldaps']
  tags: ['dhcpd']

- name: Configure DHCP server
  template:
    src: 'dhcpd.conf.ldap.j2'
    dest: '/etc/dhcp/dhcpd.conf'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify: [ 'Restart dhcpd' ]
  register: dhcpd_register_config
  tags: ['dhcpd']
